---
title: 如何管理阿里云无外网带宽的云主机
id: 171
categories:
  - 技术文章
date: 2015-04-28 23:28:37
tags:
---

可见，某些情况下还是值得这么做的。但开通主机之后，因为没有公网带宽，所以也给我们的使用带来了一些麻烦，这里讲一下我的解决办法。 没有公网，用不了外网的，无论上传还是下载，但在同一机房的其他主机，还是可以访问的，所以我们要做一个跳板，利用我们已有的云主机跳转。

这里要明确以下要点： 1、两台服务器必须在同一个数据中心，比如一台在杭州，一台在青岛，不在一个内网，肯定没法操作的；

2、两太服务器必须在同一个帐号下。不在同一个下面，默认有防火墙阻止，不能互相访问的，需要提交工单请客服设置；

技术上，通过Linux iptables，或者ssh转发都可以实现，iptables转发更简单，比如我们的主服务器，就是有公网带宽，可以访问外网的那一台， 一般我们通过22端口进行ssh操作。我们可以将2222端口转发到数据库服务器，在ssh工具里面就可以管理了。

首先，打开ip转发：

    echo 1 > /proc/sys/net/ipv4/ip_forward
    

    然后依次输入以下命令：

    > > A机有公网IP ，内网IP为 10.160.39.22
> > 
> >     B机无公网IP ，内网IP为 10.160.30.11

    规则：

    iptables -t nat -A PREROUTING -p tcp --dport 2222 -j DNAT --to-destination 10.160.30.11:22
    iptables -t nat -A POSTROUTING -d 10.160.30.11 -p tcp --dport 22 -j SNAT --to 10.160.39.22

然后保存、重启 service iptables save service iptables restart

现在，我们就能通过putty、xshell等工具管理了。ip地址填有公网ip的，端口填2222，其他如旧，很快就能登录上去了
