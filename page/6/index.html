<!doctype html>



  


<html class="theme-next pisces use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="刘立岗, 博客" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="开发笔记而已～～～">
<meta property="og:type" content="website">
<meta property="og:title" content="无来">
<meta property="og:url" content="http://www.wulai.me/page/6/index.html">
<meta property="og:site_name" content="无来">
<meta property="og:description" content="开发笔记而已～～～">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="无来">
<meta name="twitter:description" content="开发笔记而已～～～">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>



  <link rel="canonical" href="http://www.wulai.me/page/6/"/>


  <title> 无来 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-81208215-1', 'auto');
  ga('send', 'pageview');
</script>









  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">无来</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">不管你来还是不来<br />我都在这里，夜夜点亮<br />不是为了守候<br />只是为了做好我自己</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>


    </div>
  
</nav>
 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/04/28/e5-a6-82-e4-bd-95-e7-ae-a1-e7-90-86-e9-98-bf-e9-87-8c-e4-ba-91-e6-97-a0-e5-a4-96-e7-bd-91-e5-b8-a6-e5-ae-bd-e7-9a-84-e4-ba-91-e4-b8-bb-e6-9c-ba/" itemprop="url">
                  如何管理阿里云无外网带宽的云主机
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-04-28T23:28:37+08:00" content="2015-04-28">
              2015-04-28
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/技术文章/" itemprop="url" rel="index">
                    <span itemprop="name">技术文章</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>可见，某些情况下还是值得这么做的。但开通主机之后，因为没有公网带宽，所以也给我们的使用带来了一些麻烦，这里讲一下我的解决办法。 没有公网，用不了外网的，无论上传还是下载，但在同一机房的其他主机，还是可以访问的，所以我们要做一个跳板，利用我们已有的云主机跳转。</p>
<p>这里要明确以下要点： 1、两台服务器必须在同一个数据中心，比如一台在杭州，一台在青岛，不在一个内网，肯定没法操作的；</p>
<p>2、两太服务器必须在同一个帐号下。不在同一个下面，默认有防火墙阻止，不能互相访问的，需要提交工单请客服设置；</p>
<p>技术上，通过Linux iptables，或者ssh转发都可以实现，iptables转发更简单，比如我们的主服务器，就是有公网带宽，可以访问外网的那一台， 一般我们通过22端口进行ssh操作。我们可以将2222端口转发到数据库服务器，在ssh工具里面就可以管理了。</p>
<p>首先，打开ip转发：</p>
<pre><code>echo 1 &gt; /proc/sys/net/ipv4/ip_forward


然后依次输入以下命令：

&gt; &gt; A机有公网IP ，内网IP为 10.160.39.22
</code></pre><blockquote>
<blockquote>
<pre><code>B机无公网IP ，内网IP为 10.160.30.11
</code></pre></blockquote>
</blockquote>
<pre><code>规则：

iptables -t nat -A PREROUTING -p tcp --dport 2222 -j DNAT --to-destination 10.160.30.11:22
iptables -t nat -A POSTROUTING -d 10.160.30.11 -p tcp --dport 22 -j SNAT --to 10.160.39.22
</code></pre><p>然后保存、重启 service iptables save service iptables restart</p>
<p>现在，我们就能通过putty、xshell等工具管理了。ip地址填有公网ip的，端口填2222，其他如旧，很快就能登录上去了</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/04/22/mysql-e6-9c-8d-e5-8a-a1-e6-97-a0-e6-b3-95-e5-90-af-e5-8a-a8-ef-bc-9ainnodb-ibdata1-cant-be-opened-in-read-write-mode/" itemprop="url">
                  MYSQL服务无法启动：InnoDB: .\ibdata1 can&#039;t be opened in read-write mode
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-04-22T13:19:55+08:00" content="2015-04-22">
              2015-04-22
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/技术文章/" itemprop="url" rel="index">
                    <span itemprop="name">技术文章</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>今天在那做实验倒腾mysql数据库，后来发现服务无法启动，查看日志报错如下：</p>
<p>2015-01-07 17:48:54 9136 [ERROR] InnoDB: .\ibdata1 can’t be opened in read-write mode<br>2015-01-07 17:48:54 9136 [ERROR] InnoDB: The system tablespace must be writable!<br>2015-01-07 17:48:54 9136 [ERROR] Plugin ‘InnoDB’ init function returned error.<br>2015-01-07 17:48:54 9136 [ERROR] Plugin ‘InnoDB’ registration as a STORAGE ENGINE failed.<br>2015-01-07 17:48:54 9136 [ERROR] Unknown/unsupported storage engine: InnoDB<br>2015-01-07 17:48:54 9136 [ERROR] Aborting</p>
<p>解决方法：<br>1、打开任务管理器终止mysqld进程；<br>2、打开mysql安装目录的data文件夹，删除以下2个文件：<br>ib_logfile0和ib_logfile1</p>
<p>3、重新启动mysql</p>
<hr>
<p>Dylan    Presents.</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/04/22/e6-9f-a5-e7-9c-8bmysql-e7-9a-84-e9-94-99-e8-af-af-e6-97-a5-e5-bf-97-e7-9a-84-e6-96-b9-e6-b3-95/" itemprop="url">
                  查看MySQL的错误日志的方法
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-04-22T13:19:05+08:00" content="2015-04-22">
              2015-04-22
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/技术文章/" itemprop="url" rel="index">
                    <span itemprop="name">技术文章</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>我们经常在运行MySQL时会出一些错误，也经常被这些错误搞得晕头转向。当然解决这些问题的首要任务是找到日志信息。</p>
<p>MySQL的错误信息是在data目录下的，且文件名为<hostname>.err(<hostname>指的是主机名)，但由于每个人安装的环境不一样，或你忘记了data目录的所在位置，你可以通过下面方法查找。</hostname></hostname></p>
<pre><code>#hostname //获得主机名 
&lt;hostname&gt; 
#find / -name &lt;hostname&gt;.err 
..... 

#cd ... 

#vi &lt;hostname&gt;.err
</code></pre>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/03/20/e5-a6-82-e4-bd-95-e6-9f-a5-e7-9c-8bapachephpmysql-e7-9a-84-e7-bc-96-e8-af-91-e5-8f-82-e6-95-b0/" itemprop="url">
                  如何查看apache,php,mysql的编译参数
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-03-20T13:41:11+08:00" content="2015-03-20">
              2015-03-20
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/技术文章/" itemprop="url" rel="index">
                    <span itemprop="name">技术文章</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>查看nginx编译参数：/usr/local/nginx/sbin/nginx -V</p>
<p>查看apache编译参数：cat /usr/local/apache2/build/config.nice</p>
<p>查看mysql编译参数：cat /usr/local/mysql/bin/mysqlbug | grep CONFIGURE_LINE</p>
<p>查看php编译参数：/usr/local/php/bin/php -i | grep configure</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/12/30/ie-e6-8f-90-e4-ba-a4ajax-e6-8f-90-e4-ba-a4304/" itemprop="url">
                  IE提交ajax提交304
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2014-12-30T11:32:19+08:00" content="2014-12-30">
              2014-12-30
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/技术文章/" itemprop="url" rel="index">
                    <span itemprop="name">技术文章</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>增加cache</p>
<pre><code>$.ajax({  
    cache : false,  
    url : &quot;sendCode.html&quot;,  
    data : {phone : value}  
});  
</code></pre>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/12/19/php-echo-e6-88-96-e8-80-85exit-e8-be-93-e5-87-ba-e4-b8-ad-e6-96-87/" itemprop="url">
                  php echo或者exit输出中文
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2014-12-19T10:01:06+08:00" content="2014-12-19">
              2014-12-19
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/技术文章/" itemprop="url" rel="index">
                    <span itemprop="name">技术文章</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>你这是中文乱码，原因是操作环境的编码和浏览器的编码不一致造成的 1. php文件本身的编码与网页的编码应匹配</p>
<p>a. 如果欲使用gb2312编码，那么php要输出头：header(“Content-Type: text/html; charset=gb2312”)，静态页面添加<meta http-equiv="Content-Type" content="text/html; charset=gb2312"><br>，所有文件的编码格式为ANSI，可用记事本打开，另存为选择编码为ANSI，覆盖源文件。</p>
<p>b. 如果欲使用utf-8编码，那么php要输出头 ：header(“Content-Type: text/html; charset=utf-8”)，静态页面添加<meta http-equiv="Content-Type" content="text/html; charset=utf-8"><br>，所有文件的编码格式为utf-8。保存为utf-8可能会有点麻烦，一般utf-8文件开头会有BOM，如果使用 session就会出问题，可用editplus来保存，在editplus中，工具-&gt;参数选择-&gt;文件-&gt;UTF-8签名，选择总是删除，再保存就可以去掉BOM信息了。</p>
<ol>
<li>php本身不是Unicode的，所有substr之类的函数得改成mb_substr（需要装mbstring扩展）；或者用iconv转码。</li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/12/13/e9-a2-84-e6-8e-92-e5-ba-8f-e9-81-8d-e5-8e-86-e6-a0-91-e7-ae-97-e6-b3-95-e9-9d-9e-e9-80-92-e5-bd-92-e6-97-a0-e9-99-90-e6-9e-81-e5-88-86-e7-b1-bb-e7-ae-97-e6-b3-95-e5-ad-a6-e4-b9-a0-e7-ac-94-e8-ae-b0/" itemprop="url">
                  预排序遍历树算法(modified preorder tree traversal algorithm)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2014-12-13T19:47:24+08:00" content="2014-12-13">
              2014-12-13
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/技术文章/" itemprop="url" rel="index">
                    <span itemprop="name">技术文章</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>本文是我学习MySQL官方教程Managing Hierarchical Data in MySQL的笔记 多层数据结构估计所有的web开发者估计都不会陌生，各种软件的分类都是基于多层结构来设计的。 下面是一个典型的多层数据结构示意图：</p>
<p><a href="http://www.hillock.com.cn/wp-content/uploads/2014/12/thum-be1b6320354e5c0879737b855764e9d920100326152818.png" target="_blank" rel="external"><img src="http://www.hillock.com.cn/wp-content/uploads/2014/12/thum-be1b6320354e5c0879737b855764e9d920100326152818.png" alt="thum-be1b6320354e5c0879737b855764e9d920100326152818"></a></p>
<p>相关创建数据语句：</p>
<pre><code>CREATE TABLE category(
category_id INT AUTO_INCREMENT PRIMARY KEY,
name VARCHAR(20) NOT NULL,
parent INT DEFAULT NULL);

INSERT INTO category
VALUES(1,&apos;ELECTRONICS&apos;,NULL),(2,&apos;TELEVISIONS&apos;,1),(3,&apos;TUBE&apos;,2),
(4,&apos;LCD&apos;,2),(5,&apos;PLASMA&apos;,2),(6,&apos;PORTABLE ELECTRONICS&apos;,1),
(7,&apos;MP3 PLAYERS&apos;,6),(8,&apos;FLASH&apos;,7),
(9,&apos;CD PLAYERS&apos;,6),(10,&apos;2 WAY RADIOS&apos;,6);

SELECT * FROM category ORDER BY category_id;


在这种数据结构中，各层之间通过字段 parent 来形成邻接表，我们查询某些层级的关系的时候一般都是通过递归的方式，遍历某个层级关系的SQL的查询次数会顺着层级的增加，想想在层级有20的时候，根据某个底层节点取它到顶层节点的查询次数吧。

为了解决这个问题，人们想出了嵌套集模型（The Nested Set Model），请看下图：

[![thum-90ef2a4a3357d5de8e8e0d1bc026294820100326152302](http://www.hillock.com.cn/wp-content/uploads/2014/12/thum-90ef2a4a3357d5de8e8e0d1bc026294820100326152302.png)](http://www.hillock.com.cn/wp-content/uploads/2014/12/thum-90ef2a4a3357d5de8e8e0d1bc026294820100326152302.png) 上图依然是表现的与图一相同的层级关系，但是却更换了一种表现形式 下面是新的关系表和数据（关系和数据与之前相同，但是表结构不一样）：

CREATE TABLE nested_category (
category_id INT AUTO_INCREMENT PRIMARY KEY,
name VARCHAR(20) NOT NULL,
lft INT NOT NULL,
rgt INT NOT NULL,
deleted TINYINT(8)  NOT NULL DEFAULT &apos;0&apos;,
);

INSERT INTO nested_category
VALUES(1,&apos;ELECTRONICS&apos;,1,20),(2,&apos;TELEVISIONS&apos;,2,9),(3,&apos;TUBE&apos;,3,4),
(4,&apos;LCD&apos;,5,6),(5,&apos;PLASMA&apos;,7,8),(6,&apos;PORTABLE ELECTRONICS&apos;,10,19),
(7,&apos;MP3 PLAYERS&apos;,11,14),(8,&apos;FLASH&apos;,12,13),
(9,&apos;CD PLAYERS&apos;,15,16),(10,&apos;2 WAY RADIOS&apos;,17,18);

SELECT * FROM nested_category ORDER BY category_id;


这里将 left,right 修改为 lft,rgt因为这两个词在MYSQL中属于关键字 下面我们将插入的数据标识在图上： [![thum-a618905c95b8d6aa42cf4c29f7d0546a20100326152746](http://www.hillock.com.cn/wp-content/uploads/2014/12/thum-a618905c95b8d6aa42cf4c29f7d0546a20100326152746.png)](http://www.hillock.com.cn/wp-content/uploads/2014/12/thum-a618905c95b8d6aa42cf4c29f7d0546a20100326152746.png) 同样，我们将数据标识在原来的结构上： [![thum-be1b6320354e5c0879737b855764e9d920100326152818](http://www.hillock.com.cn/wp-content/uploads/2014/12/thum-be1b6320354e5c0879737b855764e9d9201003261528181.png)](http://www.hillock.com.cn/wp-content/uploads/2014/12/thum-be1b6320354e5c0879737b855764e9d9201003261528181.png)

怎么样，是不是很明确了

下面使我自己标定一种形式，方便理解

[1
      [2
           [3 4] 
           [5 6] 
           [7 8]
      9] 
      [10
           [11
                 [12 13]
           14]
           [15 16]
           [17 18]
      19]
20]


遍历整个树，查询子集 条件：左边 &gt; 父级L， 右边 &lt; 父级R

SELECT node.name
FROM nested_category AS node,
nested_category AS parent
WHERE node.lft BETWEEN parent.lft AND parent.rgt
AND parent.name = &apos;ELECTRONICS&apos;
ORDER BY node.lft;
</code></pre><ul>
<li>查询所有无分支的节点 条件：右边 = 左边L + 1<br>SELECT name FROM nested_category WHERE rgt = lft + 1;<p></p></li>
<li><p>查询某个字节点到根节点的路径</p>
<p>SELECT parent.name    FROM nested_category AS node, nested_category AS parent    WHERE node.lft BETWEEN parent.lft AND parent.rgt AND node.name = ‘FLASH’ ORDER BY parent.lft;</p>
</li>
<li><p>查询节点的深度</p>
<p>SELECT node.name, (COUNT(parent.name) - 1) AS depth    FROM nested_category AS node, nested_category AS parent    WHERE node.lft BETWEEN parent.lft AND parent.rgt    GROUP BY node.name    ORDER BY node.lft;</p>
</li>
<li><p>查询子节点的深度</p>
<p>SELECT node.name, (COUNT(parent.name) - (sub_tree.depth + 1)) AS depth    FROM nested_category AS node, nested_category AS parent, nested_category AS sub_parent,      ( SELECT node.name, (COUNT(parent.name) - 1) AS depth      FROM nested_category AS node, nested_category AS parent      WHERE node.lft BETWEEN parent.lft AND parent.rgt AND node.name = ‘PORTABLE ELECTRONICS’      GROUP BY node.name ORDER BY node.lft ) AS sub_tree<br>WHERE node.lft BETWEEN parent.lft AND parent.rgt AND node.lft BETWEEN sub_parent.lft AND sub_parent.rgt AND sub_parent.name = sub_tree.name GROUP BY node.name    ORDER BY node.lft;</p>
</li>
<li><p>插入新节点 算法详解：<br> 1.所有分类 左边和右边的值 &gt; 插入节点的左边节点记录的右值 的全部 + 2     2.插入节点 左值 = 插入位置左边节点记录的右值 + 1， 右值 = 插入位置左边节点记录的右值 + 2    例子: 在 R = 9（L8, R9）与 L = 10（L10，R11） 节点之间插入一个新节点 那么所有 左值 和 右值 &gt; 9 的节点的左值和右值需要 + 2         例如新节点右边的节点（L10，R11）左值右值都需要 + 2 那么插入后的新值为 L12 R13 新节点的左值为 9 + 1 = 10 右值为 9 + 2 = 11 SQL语句实现</p>
<p>LOCK TABLE nested_category WRITE;<br>SELECT @myRight := rgt FROM nested_category WHERE name = ‘TELEVISIONS’;<br>UPDATE nested_category SET rgt = rgt + 2 WHERE rgt &gt; @myRight;<br>UPDATE nested_category SET lft = lft + 2 WHERE lft &gt; @myRight;    INSERT INTO nested_category(name, lft, rgt) VALUES(‘GAME CONSOLES’, @myRight + 1, @myRight + 2);<br>UNLOCK TABLES;</p>
</li>
<li><p>删除新节点 删除节点的算法与添加一个节点的算法相反</p>
<p></p><p>删除一个没有子节点的节点</p>
</li>
</ul>
<pre><code>LOCK TABLE nested_category WRITE; 
SELECT @myLeft := lft, @myRight := rgt, @myWidth := rgt - lft + 1 FROM nested_category WHERE name = &apos;GAME CONSOLES&apos;; 
DELETE FROM nested_category WHERE lft BETWEEN @myLeft AND @myRight;
UPDATE nested_category SET rgt = rgt - @myWidth WHERE rgt &gt; @myRight;
UPDATE nested_category SET lft = lft - @myWidth WHERE lft &gt; @myRight;
UNLOCK TABLES;


删除一个分支节点和它所有的子节点


LOCK TABLE nested_category WRITE; 
SELECT @myLeft := lft, @myRight := rgt, @myWidth := rgt - lft + 1 FROM nested_category WHERE name = &apos;MP3 PLAYERS&apos;; 
DELETE FROM nested_category WHERE lft BETWEEN @myLeft AND @myRight; 
UPDATE nested_category SET rgt = rgt - @myWidth WHERE rgt &gt; @myRight; 
UPDATE nested_category SET lft = lft - @myWidth WHERE lft &gt; @myRight; 
UNLOCK TABLES;


删除一个节点后移动其字节点到


LOCK TABLE nested_category WRITE; 
SELECT @myLeft := lft, @myRight := rgt, @myWidth := rgt - lft + 1 FROM nested_category WHERE name = &apos;PORTABLE ELECTRONICS&apos;;
DELETE FROM nested_category WHERE lft = @myLeft; 
UPDATE nested_category SET rgt = rgt - 1, lft = lft - 1 WHERE lft BETWEEN @myLeft AND @myRight;
UPDATE nested_category SET rgt = rgt - 2 WHERE rgt &gt; @myRight; 
UPDATE nested_category SET lft = lft - 2 WHERE lft &gt; @myRight; 
UNLOCK TABLES;


### 补充：移动一个分类

将分类5移动到分类9下面

LOCK TABLE nested_category WRITE;
SELECT @myLeft := lft, @myRight := rgt, @myWidth := rgt - lft + 1
FROM nested_category
WHERE  category_id = 5;
UPDATE nested_category SET deleted=2 WHERE lft BETWEEN @myLeft AND @myRight;
UPDATE nested_category SET rgt = rgt - @myWidth WHERE rgt &gt; @myRight AND deleted=0;
UPDATE nested_category SET lft = lft - @myWidth WHERE lft &gt; @myRight AND deleted=0;

SELECT @destLeft := lft,@destRight := rgt FROM nested_category WHERE  category_id = 9;

UPDATE nested_category SET rgt = rgt + @myWidth WHERE rgt &gt; @destRight AND deleted=0;
UPDATE nested_category SET lft = lft + @myWidth WHERE lft &gt; @destRight AND deleted=0;

UPDATE nested_category SET rgt = rgt -(@myLeft-@destRight) WHERE deleted=2;
UPDATE nested_category SET lft = lft -(@myLeft-@destRight) WHERE deleted=2;
UPDATE nested_category SET rgt = rgt + @myWidth WHERE category_id = 9;
UPDATE nested_category SET deleted=0 WHERE  deleted=2;
UNLOCK TABLES;


将分类5移动到分类9前面


SELECT @myLeft := lft, @myRight := rgt, @myWidth := rgt - lft + 1 FROM nested_category WHERE  category_id = 5;
UPDATE nested_category SET deleted=2 WHERE lft BETWEEN @myLeft AND @myRight;
UPDATE nested_category SET rgt = rgt - @myWidth WHERE rgt &gt; @myRight AND deleted=0;
UPDATE nested_category SET lft = lft - @myWidth WHERE lft &gt; @myRight AND deleted=0;

SELECT @destLeft := lft,@destRight := rgt FROM nested_category WHERE  category_id = 9;

UPDATE nested_category SET rgt = rgt + @myWidth WHERE rgt &gt;= @destLeft  AND deleted=0;
UPDATE nested_category SET lft = lft + @myWidth WHERE lft &gt;= @destLeft AND deleted=0;

UPDATE nested_category SET rgt = rgt -(@myLeft-@destRight) WHERE deleted=2;
UPDATE nested_category SET lft = lft -(@myLeft-@destRight) WHERE deleted=2;
UPDATE nested_category SET deleted=0 WHERE  deleted=2;
UNLOCK TABLES;
</code></pre><p>总结： 预排序遍历树算法的核心就是牺牲了写的性能来换取读取的性能 在你的开发的应用遇到此类问题的时（读压力 &gt; 写压力），尝试下使用预排序遍历树算法来提高你的程序的性能吧。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/12/05/nginx-e5-85-a8-e5-b1-80-e5-8f-98-e9-87-8f-e5-af-b9-e7-85-a7/" itemprop="url">
                  nginx 全局变量对照
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2014-12-05T11:29:27+08:00" content="2014-12-05">
              2014-12-05
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/server/" itemprop="url" rel="index">
                    <span itemprop="name">server</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>remote_addr     客户端ip,如：192.168.4.2<br>binary_remote_addr  客户端ip（二进制)<br>remote_port     客户端port，如：50472<br>remote_user     已经经过Auth Basic Module验证的用户名<br>host            请求主机头字段，否则为服务器名称，如:dwz.stamhe.com<br>request         用户请求信息，如：GET /?_a=index&amp;_m=show&amp;count=10 HTTP/1.1<br>request_filename    当前请求的文件的路径名，由root或alias和URI request组合而成，如：/webserver/htdocs/dwz/index.php<br>status          请求的响应状态码,如:200<br>body_bytes_sent 响应时送出的body字节数数量。即使连接中断，这个数据也是精确的,如：40<br>content_length  请求头中的Content-length字段<br>content_type    请求头中的Content-Type字段<br>http_referer    引用地址<br>http_user_agent 客户端agent信息,如：Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/536.11 (KHTML, like Gecko) Chrome/20.0.1132.57 Safari/536.11<br>args            如：_a=index&amp;_m=show&amp;count=10<br>document_uri    与$uri相同,如：/index.php<br>document_root   针对当前请求的根路径设置值,如：/webserver/htdocs/dwz<br>hostname        如：centos53.localdomain<br>http_cookie     客户端cookie信息<br>cookie_COOKIE   cookie COOKIE变量的值<br>is_args         如果有$args参数，这个变量等于”?”，否则等于””，空值，如?<br>limit_rate      这个变量可以限制连接速率，0表示不限速<br>query_string    与$args相同,如：_a=index&amp;_m=show&amp;count=10<br>realpath_root   如：/webserver/htdocs/dwz<br>request_body     记录POST过来的数据信息<br>request_body_file   客户端请求主体信息的临时文件名<br>request_method  客户端请求的动作，通常为GET或POST,如：GET<br>request_uri     包含请求参数的原始URI，不包含主机名，如：”/foo/bar.php?arg=baz”。不能修改。如：/index.php?_a=index&amp;_m=show&amp;count=10<br>scheme          HTTP方法（如http，https）,如：http<br>uri             如：/index.php<br>request_completion  如果请求结束，设置为OK. 当请求未结束或如果该请求不是请求链串的最后一个时，为空(Empty)，如：OK<br>server_protocol 请求使用的协议，通常是HTTP/1.0或HTTP/1.1，如：HTTP/1.1<br>server_addr     服务器地址，在完成一次系统调用后可以确定这个值，如：192.168.4.129<br>server_name     服务器名称，如：dwz.stamhe.com<br>server_port     请求到达服务器的端口号,如：80</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/12/05/e6-9f-a5-e7-9c-8bjquery-e7-89-88-e6-9c-ac/" itemprop="url">
                  查看jquery版本
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2014-12-05T09:19:11+08:00" content="2014-12-05">
              2014-12-05
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/技术文章/" itemprop="url" rel="index">
                    <span itemprop="name">技术文章</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <pre><code>alert($.fn.jquery);
</code></pre>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/11/29/11-e4-b8-aa-e9-87-8d-e8-a6-81-e7-9a-84-e6-95-b0-e6-8d-ae-e5-ba-93-e8-ae-be-e8-ae-a1-e8-a7-84-e5-88-99/" itemprop="url">
                  11个重要的数据库设计规则
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2014-11-29T15:45:51+08:00" content="2014-11-29">
              2014-11-29
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/server/" itemprop="url" rel="index">
                    <span itemprop="name">server</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>英文原文： <a href="http://www.c-sharpcorner.com/UploadFile/shivprasadk/11-important-database-designing-rules/" target="_blank" rel="external">11 Important Database designing rules</a></p>
<h3 id="1、简介"><a href="#1、简介" class="headerlink" title="1、简介"></a>1、简介</h3><p>　　在您开始阅读这篇文章之前，我得明确地告诉您，我并不是一个数据库设计领域的大师。以下列出的 11 点是我对自己在平时项目实践和阅读中学习到的经验总结出来的个人见解。我个人认为它们对我的数据库设计提供了很大的帮助。实属一家之言，欢迎拍砖 : )</p>
<p>　　我之所以写下这篇这么完整的文章是因为，很多开发者一参与到数据库设计，就会很自然地把 “三范式” 当作银弹一样来使用。他们往往认为遵循这个规范就是数据库设计的唯一标准。由于这种心态，他们往往尽管一路碰壁也会坚持把项目做下去。</p>
<p>　　如果你对 “三范式” 不清楚，<a href="http://www.hillock.com.cn/?p=77" target="_blank" rel="external">请点击这里（FQ）</a>一步一步的了解什么是“三范式”。</p>
<p>　　大家都说标准规范是重要的指导方针并且也这么做着，但是把它当作石头上的一块标记来记着（死记硬背）还是会带来麻烦的。以下 11 点是我在数据库设计时最优先考虑的规则。</p>
<h3 id="规则-1：弄清楚将要开发的应用程序是什么性质的（OLTP-还是-OPAP）？"><a href="#规则-1：弄清楚将要开发的应用程序是什么性质的（OLTP-还是-OPAP）？" class="headerlink" title="规则 1：弄清楚将要开发的应用程序是什么性质的（OLTP 还是 OPAP）？"></a>规则 1：弄清楚将要开发的应用程序是什么性质的（OLTP 还是 OPAP）？</h3><p>　　当你要开始设计一个数据库的时候，你应该首先要分析出你为之设计的应用程序是什么类型的，它是 “事务处理型”（Transactional） 的还是 “分析型” （Analytical）的？你会发现许多开发人员采用标准化做法去设计数据库，而不考虑目标程序是什么类型的，这样做出来的程序很快就会陷入性能、客户定制化的问题当中。正如前面所说的，这里有两种应用程序类型， “基于事务处理” 和 “基于分析”，下面让我们来了解一下这两种类型究竟说的是什么意思。 　　事务处理型：这种类型的应用程序，你的最终用户更关注数据的增查改删（CRUD，Creating/Reading/Updating/Deleting）。这种类型更加官方的叫法是 “OLTP” 。</p>
<p>　　<strong>分析型：</strong> 这种类型的应用程序，你的最终用户更关注数据分析、报表、趋势预测等等功能。这一类的数据库的 “插入” 和 “更新” 操作相对来说是比较少的。它们主要的目的是更加快速地查询、分析数据。这种类型更加官方的叫法是 “OLAP” 。</p>
<p><a href="http://www.hillock.com.cn/wp-content/uploads/2014/11/2012041214001086.jpg" target="_blank" rel="external"><img src="http://www.hillock.com.cn/wp-content/uploads/2014/11/2012041214001086.jpg" alt="2012041214001086"></a></p>
<p>　　那么换句话说，如果你认为插入、更新、删除数据这些操作在你的程序中更为突出的话，那就设计一个规范化的表否则的话就去创建一个扁平的、不规范化的数据库结构。</p>
<p>　　以下这个简单的图表显示了像左边 Names 和 Address 这样的简单规范化的表，怎么通过应用不规范化结构来创建一个扁平的表结构。</p>
<p><a href="http://www.hillock.com.cn/wp-content/uploads/2014/11/2012041214003338.jpg" target="_blank" rel="external"><img src="http://www.hillock.com.cn/wp-content/uploads/2014/11/2012041214003338.jpg" alt="2012041214003338"></a></p>
<h3 id="规则-2：将你的数据按照逻辑意义分成不同的块，让事情做起来更简单"><a href="#规则-2：将你的数据按照逻辑意义分成不同的块，让事情做起来更简单" class="headerlink" title="规则 2：将你的数据按照逻辑意义分成不同的块，让事情做起来更简单"></a>规则 2：将你的数据按照逻辑意义分成不同的块，让事情做起来更简单</h3><p>　　这个规则其实就是 “三范式” 中的第一范式。违反这条规则的一个标志就是，你的查询使用了很多字符串解析函数</p>
<p>　　例如 substring、charindex 等等。若真如此，那就需要应用这条规则了。</p>
<p>　　比如你看到的下面图片上有一个有学生名字的表，如果你想要查询学生名字中包含“Koirala”，但不包含“Harisingh”的记录，你可以想象一下你将会得到什么样的结果。</p>
<p>　　所以更好的做法是将这个字段拆分为更深层次的逻辑分块，以便我们的表数据写起来更干净，以及优化查询。</p>
<p><a href="http://www.hillock.com.cn/wp-content/uploads/2014/11/2012041214010291.jpg" target="_blank" rel="external"><img src="http://www.hillock.com.cn/wp-content/uploads/2014/11/2012041214010291.jpg" alt="2012041214010291"></a></p>
<h3 id="规则-3：不要过度使用-“规则-2”"><a href="#规则-3：不要过度使用-“规则-2”" class="headerlink" title="规则 3：不要过度使用 “规则 2”"></a>规则 3：不要过度使用 “规则 2”</h3><p>　　开发者都是一群很可爱的生物。如果你告诉他们这是一条解决问题的正路，他们就会一直这么做下去，做到过了头导致了一些不必要的后果。这也可以应用于我们刚刚在前面提到的规则2。当你考虑字段分解时，先暂停一下，并且问问你自己是否真的需要这么做。正如所说的，分解应该是要符合逻辑的。</p>
<p>　　例如，你可以看到电话号码这个字段，你很少会把电话号码的 ISD 代码单独分开来操作（除非你的应用程序要求这么做）。所以一个很明智的决定就是让它保持原样，否则这会带来更多的问题。</p>
<p><a href="http://www.hillock.com.cn/wp-content/uploads/2014/11/2012041214012642.jpg" target="_blank" rel="external"><img src="http://www.hillock.com.cn/wp-content/uploads/2014/11/2012041214012642.jpg" alt="2012041214012642"></a></p>
<h3 id="规则-4：把重复、不统一的数据当成你最大的敌人来对待"><a href="#规则-4：把重复、不统一的数据当成你最大的敌人来对待" class="headerlink" title="规则 4：把重复、不统一的数据当成你最大的敌人来对待"></a>规则 4：把重复、不统一的数据当成你最大的敌人来对待</h3><p>　　集中那些重复的数据然后重构它们。我个人更加担心的是这些重复数据带来的混乱而不是它们占用了多少磁盘空间。</p>
<p>　　例如下面这个图表，你可以看到 “5th Standard” 和 “Fifth standard” 是一样的意思，它们是重复数据。现在你可能会说是由于那些录入者录入了这些重复的数据或者是差劲的验证程序没有拦住，让这些重复的数据进入到了你的系统。现在，如果你想导出一份将原本在用户眼里十分困惑的数据显示为不同实体数据的报告，该怎么做呢？</p>
<p><a href="http://www.hillock.com.cn/wp-content/uploads/2014/11/2012041214015638.jpg" target="_blank" rel="external"><img src="http://www.hillock.com.cn/wp-content/uploads/2014/11/2012041214015638.jpg" alt="2012041214015638"></a></p>
<p>　　解决方法之一是将这些数据完整地移到另外一个主表，然后通过外键引用过来。在下面这个图表中你可以看到我们是如何创建一个名为 “Standards”（课程级别） 的主表，然后同样地使用简单的外键连接过去。</p>
<p>　　 <a href="http://www.hillock.com.cn/wp-content/uploads/2014/11/2012041214022798.jpg" target="_blank" rel="external"><img src="http://www.hillock.com.cn/wp-content/uploads/2014/11/2012041214022798.jpg" alt="2012041214022798"></a></p>
<h3 id="规则-5：当心被分隔符分割的数据，它们违反了“字段不可再分”"><a href="#规则-5：当心被分隔符分割的数据，它们违反了“字段不可再分”" class="headerlink" title="规则 5：当心被分隔符分割的数据，它们违反了“字段不可再分”"></a>规则 5：当心被分隔符分割的数据，它们违反了“字段不可再分”</h3><p>　　前面的规则 2 即“第一范式”说的是避免 “重复组” 。下面这个图表作为其中的一个例子解释了 “重复组”是什么样子的。如果你仔细的观察 syllabus（课程） 这个字段，会发现在这一个字段里实在是填充了太多的数据了。像这些字段就被称为 “重复组” 了。如果我们又得必须使用这些数据，那么这些查询将会十分复杂并且我也怀疑这些查询会有性能问题。</p>
<p><a href="http://www.hillock.com.cn/wp-content/uploads/2014/11/2012041214025658.jpg" target="_blank" rel="external"><img src="http://www.hillock.com.cn/wp-content/uploads/2014/11/2012041214025658.jpg" alt="2012041214025658"></a></p>
<p>　　这些被塞满了分隔符的数据列需要特别注意，并且一个较好的办法是将这些字段移到另外一个表中，使用外键连接过去，同样地以便于更好的管理。</p>
<p><a href="http://www.hillock.com.cn/wp-content/uploads/2014/11/2012041214031733.jpg" target="_blank" rel="external"><img src="http://www.hillock.com.cn/wp-content/uploads/2014/11/2012041214031733.jpg" alt="2012041214031733"></a></p>
<p>　　那么，让我们现在就应用规则2（第一范式） “避免重复组” 吧。你可以看到上面这个图表，我创建了一个单独的 syllabus（课程） 表，然后使用 “多对多” 关系将它与 subject（科目） 表关联起来。</p>
<p>　　通过这个方法，主表（student 表）的 syllabus（课程） 字段就不再有重复数据和分隔符了。</p>
<h3 id="规则-6：当心那些仅仅部分依赖主键的列"><a href="#规则-6：当心那些仅仅部分依赖主键的列" class="headerlink" title="规则 6：当心那些仅仅部分依赖主键的列"></a>规则 6：当心那些仅仅部分依赖主键的列</h3><p><a href="http://www.hillock.com.cn/wp-content/uploads/2014/11/2012041214033858.jpg" target="_blank" rel="external"><img src="http://www.hillock.com.cn/wp-content/uploads/2014/11/2012041214033858.jpg" alt="2012041214033858"></a></p>
<p>　　留心注意那些仅仅部分依赖主键的列。例如上面这个图表，我们可以看到这个表的主键是 Roll No.+Standard。现在请仔细观察 syllabus 字段，可以看到 syllabus（课程） 字段仅仅关联（依赖） Standard（课程级别） 字段而不是直接地关联（依赖）某个学生（Roll No. 字段）。</p>
<p>　　Syllabus（课程） 字段关联的是学生正在学习的哪个课程级别（Standard 字段）而不是直接关联到学生本身。那如果明天我们要更新教学大纲（课程）的话还要痛苦地为每个同学也修改一下，这明显是不符合逻辑的（不正常的做法）。更有意义的做法是将这些字段从这个表移到另外一个表，然后将它们与 Standard（课程级别）表关联起来。</p>
<p>　　你可以看到我们是如何移动 syllabus（课程）字段并且同样地附上 Standard 表。</p>
<p>　　这条规则只不过是 “三范式” 里的 “第二范式”：“所有字段都必须完整地依赖主键而不是部分依赖”。 　　</p>
<h3 id="规则-7：仔细地选择派生列"><a href="#规则-7：仔细地选择派生列" class="headerlink" title="规则 7：仔细地选择派生列"></a>规则 7：仔细地选择派生列</h3><p><a href="http://www.hillock.com.cn/wp-content/uploads/2014/11/2012041214040275.jpg" target="_blank" rel="external"><img src="http://www.hillock.com.cn/wp-content/uploads/2014/11/2012041214040275.jpg" alt="2012041214040275"></a></p>
<p>　　如果你正在开发一个 OLTP 型的应用程序，那强制不去使用派生字段会是一个很好的思路，除非有迫切的性能要求，比如经常需要求和、计算的 OLAP 程序，为了性能，这些派生字段就有必要存在了。</p>
<p>　　通过上面的这个图表，你可以看到 Average 字段是如何依赖 Marks 和 Subjects 字段的。这也是冗余的一种形式。因此对于这样的由其他字段得到的字段，需要思考一下它们是否真的有必要存在。</p>
<p>　　这个规则也被称为 “三范式” 里的第三条：“不应该有依赖于非主键的列” 。 我的个人看法是不要盲目地运用这条规则，应该要看实际情况，冗余数据并不总是坏的。如果冗余数据是计算出来的，看看实际情况再来决定是否应用这第三范式。</p>
<h3 id="规则-8：如果性能是关键，不要固执地去避免冗余"><a href="#规则-8：如果性能是关键，不要固执地去避免冗余" class="headerlink" title="规则 8：如果性能是关键，不要固执地去避免冗余"></a>规则 8：如果性能是关键，不要固执地去避免冗余</h3><p><a href="http://www.hillock.com.cn/wp-content/uploads/2014/11/20120412140431791.jpg" target="_blank" rel="external"><img src="http://www.hillock.com.cn/wp-content/uploads/2014/11/20120412140431791.jpg" alt="2012041214043179"></a></p>
<p>　　不要把 “避免冗余” 当作是一条绝对的规则去遵循。如果对性能有迫切的需求，考虑一下打破常规。常规情况下你需要做多个表的连接操作，而在非常规的情况下这样的多表连接是会大大地降低性能的。 　　</p>
<h3 id="规则-9：多维数据是各种不同数据的聚合"><a href="#规则-9：多维数据是各种不同数据的聚合" class="headerlink" title="规则 9：多维数据是各种不同数据的聚合"></a>规则 9：多维数据是各种不同数据的聚合</h3><p>　　OLAP 项目主要是解决多维数据问题。比如你可以看看下面这个图表，你会想拿到每个国家、每个顾客、每段时期的销售额情况。简单的说你正在看的销售额数据包含了三个维度的交叉。</p>
<p><a href="http://www.hillock.com.cn/wp-content/uploads/2014/11/2012041214045413.jpg" target="_blank" rel="external"><img src="http://www.hillock.com.cn/wp-content/uploads/2014/11/2012041214045413.jpg" alt="2012041214045413"></a></p>
<p>　　为这种情况做一个实际的设计是一个更好的办法。简单的说，你可以创建一个简单的主要销售表，它包含了销售额字段，通过外键将其他所有不同维度的表连接起来。</p>
<p><a href="http://www.hillock.com.cn/wp-content/uploads/2014/11/2012041214051867.jpg" target="_blank" rel="external"><img src="http://www.hillock.com.cn/wp-content/uploads/2014/11/2012041214051867.jpg" alt="2012041214051867"></a></p>
<p><a href="http://www.hillock.com.cn/wp-content/uploads/2014/11/a15.jpg" target="_blank" rel="external"><img src="http://www.hillock.com.cn/wp-content/uploads/2014/11/a15.jpg" alt="a15"></a></p>
<h3 id="规则-10：将那些具有“名值表”特点的表统一起来设计"><a href="#规则-10：将那些具有“名值表”特点的表统一起来设计" class="headerlink" title="规则 10：将那些具有“名值表”特点的表统一起来设计"></a>规则 10：将那些具有“名值表”特点的表统一起来设计</h3><p>　　很多次我都遇到过这种 “名值表” 。 “名值表” 意味着它有一些键，这些键被其他数据关联着。比如下面这个图表，你可以看到我们有 Currency（货币型）和 Country（国家）这两张表。如果你仔细观察你会发现实际上这些表都只有键和值。</p>
<p><a href="http://www.hillock.com.cn/wp-content/uploads/2014/11/2012041214061280.jpg" target="_blank" rel="external"><img src="http://www.hillock.com.cn/wp-content/uploads/2014/11/2012041214061280.jpg" alt="2012041214061280"></a></p>
<p>　　对于这种表，创建一个主要的表，通过一个 Type（类型）字段来区分不同的数据将会更有意义。 　　</p>
<h3 id="规则-11：无限分级结构的数据，引用自己的主键作为外键"><a href="#规则-11：无限分级结构的数据，引用自己的主键作为外键" class="headerlink" title="规则 11：无限分级结构的数据，引用自己的主键作为外键"></a>规则 11：无限分级结构的数据，引用自己的主键作为外键</h3><p>　　我们会经常碰到一些无限父子分级结构的数据（树形结构？）。例如考虑一个多级销售方案的情况，一个销售人员之下可以有多个销售人员。注意到都是 “销售人员” 。也就是说数据本身都是一种。但是层级不同。这时候我们可以引用自己的主键作为外键来表达这种层级关系，从而达成目的。</p>
<p><a href="http://www.hillock.com.cn/wp-content/uploads/2014/11/2012041214063167.jpg" target="_blank" rel="external"><img src="http://www.hillock.com.cn/wp-content/uploads/2014/11/2012041214063167.jpg" alt="2012041214063167"></a></p>
<p>　　这篇文章的用意不是叫大家不要遵循范式，而是叫大家不要盲目地遵循范式。根据你的项目性质和需要处理的数据类型来做出正确的选择。</p>
<p><a href="http://www.hillock.com.cn/wp-content/uploads/2014/11/2012041214065062.jpg" target="_blank" rel="external"><img src="http://www.hillock.com.cn/wp-content/uploads/2014/11/2012041214065062.jpg" alt="2012041214065062"></a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/5/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><span class="page-number current">6</span><a class="page-number" href="/page/7/">7</a><a class="page-number" href="/page/8/">8</a><a class="extend next" rel="next" href="/page/7/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="https://avatars2.githubusercontent.com/u/3354580?v=3&s=460"
               alt="Hillock" />
          <p class="site-author-name" itemprop="name">Hillock</p>
          <p class="site-description motion-element" itemprop="description">开发笔记而已～～～</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">78</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">8</span>
                <span class="site-state-item-name">分类</span>
              
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">2</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/liuhill" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://twitter.com/LiuLig" target="_blank" title="Twitter">
                  
                    <i class="fa fa-fw fa-twitter"></i>
                  
                  Twitter
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/liuhill" target="_blank" title="Weibo">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                  Weibo
                </a>
              </span>
            
          
        </div>

        
        

        
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Hillock</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.0.1"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  



  




  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
       search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="popoverlay">').css('overflow', 'hidden');
      $('.popup').toggle();

    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
    'use strict';
    $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
            // get the contents from search data
            isfetched = true;
            $('.popup').detach().appendTo('.header-inner');
            var datas = $( "entry", xmlResponse ).map(function() {
                return {
                    title: $( "title", this ).text(),
                    content: $("content",this).text(),
                    url: $( "url" , this).text()
                };
            }).get();
            var $input = document.getElementById(search_id);
            var $resultContent = document.getElementById(content_id);
            $input.addEventListener('input', function(){
                var matchcounts = 0;
                var str='<ul class=\"search-result-list\">';
                var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                $resultContent.innerHTML = "";
                if (this.value.trim().length > 1) {
                // perform local searching
                datas.forEach(function(data) {
                    var isMatch = true;
                    var content_index = [];
                    var data_title = data.title.trim().toLowerCase();
                    var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                    var data_url = data.url;
                    var index_title = -1;
                    var index_content = -1;
                    var first_occur = -1;
                    // only match artiles with not empty titles and contents
                    if(data_title != '' && data_content != '') {
                        keywords.forEach(function(keyword, i) {
                            index_title = data_title.indexOf(keyword);
                            index_content = data_content.indexOf(keyword);
                            if( index_title < 0 && index_content < 0 ){
                                isMatch = false;
                            } else {
                                if (index_content < 0) {
                                    index_content = 0;
                                }
                                if (i == 0) {
                                    first_occur = index_content;
                                }
                            }
                        });
                    }
                    // show search results
                    if (isMatch) {
                        matchcounts += 1;
                        str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                        var content = data.content.trim().replace(/<[^>]+>/g,"");
                        if (first_occur >= 0) {
                            // cut out 100 characters
                            var start = first_occur - 20;
                            var end = first_occur + 80;
                            if(start < 0){
                                start = 0;
                            }
                            if(start == 0){
                                end = 50;
                            }
                            if(end > content.length){
                                end = content.length;
                            }
                            var match_content = content.substring(start, end);
                            // highlight all keywords
                            keywords.forEach(function(keyword){
                                var regS = new RegExp(keyword, "gi");
                                match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                            });

                            str += "<p class=\"search-result\">" + match_content +"...</p>"
                        }
                        str += "</li>";
                    }
                })};
                str += "</ul>";
                if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
                if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
                $resultContent.innerHTML = str;
            });
            proceedsearch();
        }
    });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };

    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".popoverlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>


  

  

  

</body>
</html>
